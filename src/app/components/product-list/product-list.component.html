<section class="product-list">
  <div id="grid-cards" class="products-grid">
    <div class="product-row" *ngFor="let p of products">
      <div class="product-info">
        <img [src]="p.image" [alt]="p.title" />
        <div class="product-details">
          <!-- Truncado con función -->
          <h3 class="md_title">{{ truncate(p.title, 35) }}</h3>
          <p class="md_description">
            {{ truncate(p.description, 50) }}
          </p>
          <span class="md_ver-mas" (click)="openModal(p)">ver más</span>
          <p class="price">${{ p.price }}</p>
        </div>
      </div>
      <div class="product-actions">
        <button
          class="my_button"
          *ngIf="!cart.hasProduct(p)"
          (click)="addToCart(p)"
        >
          Agregar
        </button>
        <div *ngIf="cart.hasProduct(p)" class="quantity-controls">
          <button (click)="decreaseQuantity(p)">-</button>
          <span>{{ cart.getQuantity(p) }}</span>
          <button (click)="increaseQuantity(p)">+</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal Angular -->
<div
  class="md_modal"
  [class.md_show]="modalOpen"
  (click)="closeModalOnOutside($event)"
>
  <div class="md_modal-content">
    <span class="md_close" (click)="closeModal()">&times;</span>
    <img [src]="selectedProduct?.image" [alt]="selectedProduct?.title" />
    <h3>{{ selectedProduct?.title }}</h3>
    <p>{{ selectedProduct?.description }}</p>
    <p class="price">${{ selectedProduct?.price }}</p>
    <p>Categoria: {{ selectedProduct?.category }}</p>
    <div class="product-actions">
      <button
        class="my_button"
        *ngIf="selectedProduct && !cart.hasProduct(selectedProduct)"
        (click)="addToCart(selectedProduct)"
      >
        Agregar
      </button>
      <div
        *ngIf="selectedProduct && cart.hasProduct(selectedProduct)"
        class="quantity-controls"
      >
        <button (click)="decreaseQuantity(selectedProduct)">-</button>
        <span>{{ cart.getQuantity(selectedProduct) }}</span>
        <button (click)="increaseQuantity(selectedProduct)">+</button>
      </div>
    </div>
  </div>
</div>

<!-- Drawer del carrito -->
<div class="cart-drawer" [class.open]="cartOpen" [class.pinned]="cartPinned">
  <div class="cart-header">
    <h2>Carrito</h2>
    <span class="cart-close" (click)="toggleCart()">&times;</span>
  </div>
    <ul>
    <li *ngFor="let item of cart.items()">
      <div class="cart-item">
        <img [src]="item.product.image" [alt]="item.product.title" />
        <div class="cart-item-info">
          <span class="cart-item-title">{{ item.product.title }}</span>
          <span class="cart-item-qty">
            x {{ item.quantity }} = ${{ item.product.price * item.quantity }}
          </span>
        </div>
      </div>
    </li>
  </ul>

  <p>Total: ${{ cart.total() }}</p>
  <div class="btns_cart">
    <button (click)="cleanCart()">Limpiar Carrito</button>
    <button (click)="togglePin()">{{ cartPinned ? "Desfijar" : "Fijar" }}</button>
  </div>
</div>

<button 
  class="cart-button" 
  (click)="toggleCart()" 
  *ngIf="!cartPinned && !cartOpen">
  Carrito ({{ cart.totalItems() }})
</button>
